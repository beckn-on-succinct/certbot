{
    "name": "flow2",
    "steps": [
        {
            "name": "search",
            "request_finalizer": [  "var UUID = Java.type('java.util.UUID') ;",
                                    "var message_id = UUID.randomUUID().toString();",
                                    "var transaction_id = UUID.randomUUID().toString() ;",
                                    "request.body.context.message_id = message_id ;",
                                    "request.body.context.transaction_id = transaction_id ; ",
                                    "request.body.message.intent.payment = bap.payment ; "],
            "request": {
                "body": {
                    "context": {
                        "bpp_id": "${context.bpp_id}",
                        "city": "${context.city}",
                        "core_version": "${context.core_version}",
                        "country": "${context.country}",
                        "domain": "${context.domain}",
                        "action": "search",
                        "bap_id": "${context.bap_id}",
                        "bap_uri": "${context.bap_uri}",
                        "ttl": "${context.ttl}",
                        "timestamp": "${env.now}"
                    },
                    "message": {
                        "intent": {
                            "fulfillment": {
                                "type": "Delivery"
                            }
                        }
                    }
                },
                "headers": {
                    "Authorization": "${authorization.basic}",
                    "Content-Type": "application/json",
                    "X-CallBackToBeSynchronized": "Y"
                },
                "method": "post",
                "timeout": 60,
                "url": "${sync_bap_url}/search"
            },
            "response" : { 
                "status" : 200 ,
                "data" : [
                    {"context":{"transaction_id":"315b21a9-e5a7-4ec8-b08d-59fd2a989f7b","country":"IND","bpp_id":"preprod-wiggles.humbhionline.in","city":"std:080","message_id":"2485aed0-9bd0-4939-8d35-ef10f1f6aa16","core_version":"1.2.0","ttl":"PT30S","bap_id":"certbot-preprod.humbhionline.in","bpp_uri":"https://preprod-wiggles.humbhionline.in/bpp","domain":"ONDC:RET10","action":"on_search","bap_uri":"https://certbot-preprod.humbhionline.in/bap","timestamp":"2023-11-10T18:39:16.890Z"},"message":{"catalog":{"bpp/providers":[{"fulfillments":[{"@ondc/org/TAT":"PT120H","contact":{"phone":"1234567890","email":"venkatramanm@gmail.com"},"@ondc/org/category":"Standard Delivery","state":{"descriptor":{"code":"Serviceable"}},"id":"./local_retail/ind/2@preprod-wiggles.humbhionline.in.fulfillment","rateable":false,"type":"Delivery","@ondc/org/provider_name":"Wiggles","tracking":false}],"category_id":"Pet Care","payments":[{"@ondc/org/buyer_app_finder_fee_type":"percent","@ondc/org/withholding_amount":"0","id":"./local_retail/ind/1@preprod-wiggles.humbhionline.in.payment","collected_by":"BAP","type":"ON-ORDER","@ondc/org/buyer_app_finder_fee_amount":"3"}],"locations":[{"address":{"country":"IN","city":"Bengaluru","street":"Pride Apartment 182 Bannerghatta Main Road Phase 4 Bilekahalli","area_code":"560076","name":"Wiggles shopify store","locality":"A302","state":"Karnataka"},"id":"./local_retail/ind/80777412902@preprod-wiggles.humbhionline.in.provider_location","time":{"schedule":{"times":["0000"],"holidays":[],"frequency":"PT24H"},"holidays":[],"days":"1,2,3,4,5,6,7","label":"enable","timestamp":"2023-11-07T14:12:41.760Z"},"descriptor":{"name":"Wiggles shopify store"},"gps":"12.902848,77.599918"}],"descriptor":{"symbol":"https://cdn.shopify.com/s/files/1/0647/3662/4854/files/logo_2_1_fc405c5b-4db5-419a-8ec3-380144685e90.svg?v=1669615619","images":["https://cdn.shopify.com/s/files/1/0647/3662/4854/files/logo_2_1_fc405c5b-4db5-419a-8ec3-380144685e90.svg?v=1669615619"],"code":"preprod-wiggles.humbhionline.in","name":"Wiggles shopify store","short_desc":"Wiggles shopify store","long_desc":"Wiggles shopify store"},"time":{"label":"enable","timestamp":"2023-11-10T18:39:16.890Z"},"id":"preprod-wiggles.humbhionline.in","rateable":false,"items":[{"@ondc/org/cancellable":true,"@ondc/org/returnable":false,"quantity":{"available":{"count":"50"},"maximum":{"count":"50"},"unitized":{"measure":{"unit":"unit","computed_value":"0","value":"1","estimated_value":"0"},"count":1}},"location_ids":["./local_retail/ind/80777412902@preprod-wiggles.humbhionline.in.provider_location"],"@ondc/org/statutory_reqs_packaged_commodities":{"common_or_generic_name_of_commodity":"Dogs of all ages","net_quantity_or_measure_of_commodity_in_pkg":"100 gms","imported_product_country_of_origin":"IND","manufacturer_or_packer_name":"Wiggles","manufacturer_or_packer_address":"Wiggles shopify store, , ,Pride Apartment 182 Bannerghatta Main Road Phase 4 Bilekahalli,A302, ,Bengaluru,Karnataka,IN,560076","month_year_of_manufacture_packing_import":"Please refer to the packaging of the product"},"@ondc/org/contact_details_consumer_care":"Wiggles shopify store,venkatramanm@gmail.com,1234567890","@ondc/org/seller_pickup_return":false,"@ondc/org/time_to_ship":"PT48H","descriptor":{"symbol":"https://cdn.shopify.com/s/files/1/0739/2454/2758/products/HoneyChicken_Front.png?v=1680605927","images":["https://cdn.shopify.com/s/files/1/0739/2454/2758/products/HoneyChicken_Front.png?v=1680605927","https://cdn.shopify.com/s/files/1/0739/2454/2758/products/HoneyChicken_Back.png?v=1680605927"],"code":"Barkstix Dog Treats for Training Adult & Puppies (Honey Chicken)","name":"Barkstix Dog Treats for Training Adult & Puppies (Honey Chicken) - ( 100gm )","short_desc":"Barkstix Dog Treats for Training Adult & Puppies (Honey Chicken) - ( 100gm )","long_desc":"Barkstix Dog Treats for Training Adult & Puppies (Honey Chicken) - ( 100gm )"},"payment_ids":["./local_retail/ind/1@preprod-wiggles.humbhionline.in.payment"],"rateable":false,"location_id":"./local_retail/ind/80777412902@preprod-wiggles.humbhionline.in.provider_location","fulfillment_ids":["./local_retail/ind/2@preprod-wiggles.humbhionline.in.fulfillment"],"tags":[{"code":"origin","list":[{"code":"country","value":"IND"}]},{"code":"veg_nonveg","list":[{"code":"veg","value":"no"}]}],"fulfillment_id":"./local_retail/ind/2@preprod-wiggles.humbhionline.in.fulfillment","recommended":true,"@ondc/org/return_window":"PT0S","@ondc/org/available_on_cod":false,"category_id":"Pet Care","related":true,"price":{"listed_value":"229","offered_value":"229","currency":"INR","maximum_value":"229","value":"229"},"matched":true,"time":{"label":"enable","timestamp":"2023-11-05T18:30:00.000Z"},"id":"./local_retail/ind/44773308137766@preprod-wiggles.humbhionline.in.item"},{"@ondc/org/cancellable":true,"@ondc/org/returnable":false,"quantity":{"available":{"count":"50"},"maximum":{"count":"50"},"unitized":{"measure":{"unit":"unit","computed_value":"0","value":"1","estimated_value":"0"},"count":1}},"location_ids":["./local_retail/ind/80777412902@preprod-wiggles.humbhionline.in.provider_location"],"@ondc/org/statutory_reqs_packaged_commodities":{"common_or_generic_name_of_commodity":"Dogs of all ages","net_quantity_or_measure_of_commodity_in_pkg":"100 gms","imported_product_country_of_origin":"IND","manufacturer_or_packer_name":"Wiggles","manufacturer_or_packer_address":"Wiggles shopify store, , ,Pride Apartment 182 Bannerghatta Main Road Phase 4 Bilekahalli,A302, ,Bengaluru,Karnataka,IN,560076","month_year_of_manufacture_packing_import":"Please refer to the packaging of the product"},"@ondc/org/contact_details_consumer_care":"Wiggles shopify store,venkatramanm@gmail.com,1234567890","@ondc/org/seller_pickup_return":false,"@ondc/org/time_to_ship":"PT48H","descriptor":{"symbol":"https://cdn.shopify.com/s/files/1/0739/2454/2758/products/1_Chicken_Banana-Front.png?v=1680605266","images":["https://cdn.shopify.com/s/files/1/0739/2454/2758/products/1_Chicken_Banana-Front.png?v=1680605266","https://cdn.shopify.com/s/files/1/0739/2454/2758/products/Chicken_Banana-PDP_2_1.png?v=1680605266","https://cdn.shopify.com/s/files/1/0739/2454/2758/products/Chicken_Banana-PDP_3_1.png?v=1680605266"],"code":"Barkstix Dog Treats for Training Adult & Puppies - Chicken & Banana","name":"Barkstix Dog Treats for Training Adult & Puppies - Chicken & Banana - ( 100gm )","short_desc":"Barkstix Dog Treats for Training Adult & Puppies - Chicken & Banana - ( 100gm )","long_desc":"Barkstix Dog Treats for Training Adult & Puppies - Chicken & Banana - ( 100gm )"},"payment_ids":["./local_retail/ind/1@preprod-wiggles.humbhionline.in.payment"],"rateable":false,"location_id":"./local_retail/ind/80777412902@preprod-wiggles.humbhionline.in.provider_location","fulfillment_ids":["./local_retail/ind/2@preprod-wiggles.humbhionline.in.fulfillment"],"tags":[{"code":"origin","list":[{"code":"country","value":"IND"}]},{"code":"veg_nonveg","list":[{"code":"veg","value":"no"}]}],"fulfillment_id":"./local_retail/ind/2@preprod-wiggles.humbhionline.in.fulfillment","recommended":true,"@ondc/org/return_window":"PT0S","@ondc/org/available_on_cod":false,"category_id":"Pet Care","related":true,"price":{"listed_value":"189","offered_value":"189","currency":"INR","maximum_value":"249","value":"189"},"matched":true,"time":{"label":"enable","timestamp":"2023-11-05T18:30:00.000Z"},"id":"./local_retail/ind/44773217239334@preprod-wiggles.humbhionline.in.item"},{"@ondc/org/cancellable":true,"@ondc/org/returnable":false,"quantity":{"available":{"count":"50"},"maximum":{"count":"50"},"unitized":{"measure":{"unit":"unit","computed_value":"0","value":"1","estimated_value":"0"},"count":1}},"location_ids":["./local_retail/ind/80777412902@preprod-wiggles.humbhionline.in.provider_location"],"@ondc/org/statutory_reqs_packaged_commodities":{"common_or_generic_name_of_commodity":"Dogs of all ages","net_quantity_or_measure_of_commodity_in_pkg":"100 gms","imported_product_country_of_origin":"IND","manufacturer_or_packer_name":"Wiggles","manufacturer_or_packer_address":"Wiggles shopify store, , ,Pride Apartment 182 Bannerghatta Main Road Phase 4 Bilekahalli,A302, ,Bengaluru,Karnataka,IN,560076","month_year_of_manufacture_packing_import":"Please refer to the packaging of the product"},"@ondc/org/contact_details_consumer_care":"Wiggles shopify store,venkatramanm@gmail.com,1234567890","@ondc/org/seller_pickup_return":false,"@ondc/org/time_to_ship":"PT48H","descriptor":{"symbol":"https://cdn.shopify.com/s/files/1/0739/2454/2758/products/Barkstix_Chicken_Strawberry.png?v=1680605733","images":["https://cdn.shopify.com/s/files/1/0739/2454/2758/products/Barkstix_Chicken_Strawberry.png?v=1680605733","https://cdn.shopify.com/s/files/1/0739/2454/2758/products/Chicken_Strawberry-PDP_2_1.png?v=1680605733","https://cdn.shopify.com/s/files/1/0739/2454/2758/products/Chicken_Strawberry-PDP_3_1.png?v=1680605733"],"code":"Barkstix Dog Treats for Training Adult & Puppies, (Chicken & Strawberry)","name":"Barkstix Dog Treats for Training Adult & Puppies, (Chicken & Strawberry) - ( 100gm )","short_desc":"Barkstix Dog Treats for Training Adult & Puppies, (Chicken & Strawberry) - ( 100gm )","long_desc":"Barkstix Dog Treats for Training Adult & Puppies, (Chicken & Strawberry) - ( 100gm )"},"payment_ids":["./local_retail/ind/1@preprod-wiggles.humbhionline.in.payment"],"rateable":false,"location_id":"./local_retail/ind/80777412902@preprod-wiggles.humbhionline.in.provider_location","fulfillment_ids":["./local_retail/ind/2@preprod-wiggles.humbhionline.in.fulfillment"],"tags":[{"code":"origin","list":[{"code":"country","value":"IND"}]},{"code":"veg_nonveg","list":[{"code":"veg","value":"no"}]}],"fulfillment_id":"./local_retail/ind/2@preprod-wiggles.humbhionline.in.fulfillment","recommended":true,"@ondc/org/return_window":"PT0S","@ondc/org/available_on_cod":false,"category_id":"Pet Care","related":true,"price":{"listed_value":"229","offered_value":"229","currency":"INR","maximum_value":"229","value":"229"},"matched":true,"time":{"label":"enable","timestamp":"2023-11-05T18:30:00.000Z"},"id":"./local_retail/ind/44773286805798@preprod-wiggles.humbhionline.in.item"},{"@ondc/org/cancellable":true,"@ondc/org/returnable":false,"quantity":{"available":{"count":"50"},"maximum":{"count":"50"},"unitized":{"measure":{"unit":"unit","computed_value":"0","value":"1","estimated_value":"0"},"count":1}},"location_ids":["./local_retail/ind/80777412902@preprod-wiggles.humbhionline.in.provider_location"],"@ondc/org/statutory_reqs_packaged_commodities":{"common_or_generic_name_of_commodity":"Dogs of all ages","net_quantity_or_measure_of_commodity_in_pkg":"100 gms","imported_product_country_of_origin":"IND","manufacturer_or_packer_name":"Wiggles","manufacturer_or_packer_address":"Wiggles shopify store, , ,Pride Apartment 182 Bannerghatta Main Road Phase 4 Bilekahalli,A302, ,Bengaluru,Karnataka,IN,560076","month_year_of_manufacture_packing_import":"Please refer to the packaging of the product"},"@ondc/org/contact_details_consumer_care":"Wiggles shopify store,venkatramanm@gmail.com,1234567890","@ondc/org/seller_pickup_return":false,"@ondc/org/time_to_ship":"PT48H","descriptor":{"symbol":"https://cdn.shopify.com/s/files/1/0739/2454/2758/products/Barkstix_Lamb_Peanutbutter.png?v=1680605713","images":["https://cdn.shopify.com/s/files/1/0739/2454/2758/products/Barkstix_Lamb_Peanutbutter.png?v=1680605713","https://cdn.shopify.com/s/files/1/0739/2454/2758/products/Barkstix_Lamb_Peanutbutter_Back.png?v=1680605713","https://cdn.shopify.com/s/files/1/0739/2454/2758/products/Lamb_peanut_USPImage.png?v=1680605713"],"code":"Barkstix Dog Treats for Training Adult & Puppies, (Lamb & Peanut Butter)","name":"Barkstix Dog Treats for Training Adult & Puppies, (Lamb & Peanut Butter) - ( 100gm )","short_desc":"Barkstix Dog Treats for Training Adult & Puppies, (Lamb & Peanut Butter) - ( 100gm )","long_desc":"Barkstix Dog Treats for Training Adult & Puppies, (Lamb & Peanut Butter) - ( 100gm )"},"payment_ids":["./local_retail/ind/1@preprod-wiggles.humbhionline.in.payment"],"rateable":false,"location_id":"./local_retail/ind/80777412902@preprod-wiggles.humbhionline.in.provider_location","fulfillment_ids":["./local_retail/ind/2@preprod-wiggles.humbhionline.in.fulfillment"],"tags":[{"code":"origin","list":[{"code":"country","value":"IND"}]},{"code":"veg_nonveg","list":[{"code":"veg","value":"no"}]}],"fulfillment_id":"./local_retail/ind/2@preprod-wiggles.humbhionline.in.fulfillment","recommended":true,"@ondc/org/return_window":"PT0S","@ondc/org/available_on_cod":false,"category_id":"Pet Care","related":true,"price":{"listed_value":"159","offered_value":"159","currency":"INR","maximum_value":"229","value":"159"},"matched":true,"time":{"label":"enable","timestamp":"2023-11-05T18:30:00.000Z"},"id":"./local_retail/ind/44773282873638@preprod-wiggles.humbhionline.in.item"},{"@ondc/org/cancellable":true,"@ondc/org/returnable":false,"quantity":{"available":{"count":"50"},"maximum":{"count":"50"},"unitized":{"measure":{"unit":"unit","computed_value":"0","value":"1","estimated_value":"0"},"count":1}},"location_ids":["./local_retail/ind/80777412902@preprod-wiggles.humbhionline.in.provider_location"],"@ondc/org/statutory_reqs_packaged_commodities":{"common_or_generic_name_of_commodity":"Dogs of all ages","net_quantity_or_measure_of_commodity_in_pkg":"100 gms","imported_product_country_of_origin":"IND","manufacturer_or_packer_name":"Wiggles","manufacturer_or_packer_address":"Wiggles shopify store, , ,Pride Apartment 182 Bannerghatta Main Road Phase 4 Bilekahalli,A302, ,Bengaluru,Karnataka,IN,560076","month_year_of_manufacture_packing_import":"Please refer to the packaging of the product"},"@ondc/org/contact_details_consumer_care":"Wiggles shopify store,venkatramanm@gmail.com,1234567890","@ondc/org/seller_pickup_return":false,"@ondc/org/time_to_ship":"PT48H","descriptor":{"symbol":"https://cdn.shopify.com/s/files/1/0739/2454/2758/products/BerryBlast_Front.png?v=1680605946","images":["https://cdn.shopify.com/s/files/1/0739/2454/2758/products/BerryBlast_Front.png?v=1680605946","https://cdn.shopify.com/s/files/1/0739/2454/2758/products/BerryBlast-PDP_2_1.png?v=1680605946","https://cdn.shopify.com/s/files/1/0739/2454/2758/products/BerryBlast-PDP_3_1.png?v=1680605946"],"code":"Barkstix Dog Treats for Training Adult & Puppies, 100g (Berry Blast)","name":"Barkstix Dog Treats for Training Adult & Puppies, 100g (Berry Blast) - ( 100 g )","short_desc":"Barkstix Dog Treats for Training Adult & Puppies, 100g (Berry Blast) - ( 100 g )","long_desc":"Barkstix Dog Treats for Training Adult & Puppies, 100g (Berry Blast) - ( 100 g )"},"payment_ids":["./local_retail/ind/1@preprod-wiggles.humbhionline.in.payment"],"rateable":false,"location_id":"./local_retail/ind/80777412902@preprod-wiggles.humbhionline.in.provider_location","fulfillment_ids":["./local_retail/ind/2@preprod-wiggles.humbhionline.in.fulfillment"],"tags":[{"code":"origin","list":[{"code":"country","value":"IND"}]},{"code":"veg_nonveg","list":[{"code":"veg","value":"no"}]}],"fulfillment_id":"./local_retail/ind/2@preprod-wiggles.humbhionline.in.fulfillment","recommended":true,"@ondc/org/return_window":"PT0S","@ondc/org/available_on_cod":false,"category_id":"Pet Care","related":true,"price":{"listed_value":"154","offered_value":"154","currency":"INR","maximum_value":"229","value":"154"},"matched":true,"time":{"label":"enable","timestamp":"2023-11-10T11:16:31.000Z"},"id":"./local_retail/ind/44773310038310@preprod-wiggles.humbhionline.in.item"},{"@ondc/org/cancellable":true,"@ondc/org/returnable":false,"quantity":{"available":{"count":"50"},"maximum":{"count":"50"},"unitized":{"measure":{"unit":"unit","computed_value":"0","value":"1","estimated_value":"0"},"count":1}},"location_ids":["./local_retail/ind/80777412902@preprod-wiggles.humbhionline.in.provider_location"],"@ondc/org/statutory_reqs_packaged_commodities":{"common_or_generic_name_of_commodity":"Dogs of all ages","net_quantity_or_measure_of_commodity_in_pkg":"100 gms","imported_product_country_of_origin":"IND","manufacturer_or_packer_name":"Wiggles","manufacturer_or_packer_address":"Wiggles shopify store, , ,Pride Apartment 182 Bannerghatta Main Road Phase 4 Bilekahalli,A302, ,Bengaluru,Karnataka,IN,560076","month_year_of_manufacture_packing_import":"Please refer to the packaging of the product"},"@ondc/org/contact_details_consumer_care":"Wiggles shopify store,venkatramanm@gmail.com,1234567890","@ondc/org/seller_pickup_return":false,"@ondc/org/time_to_ship":"PT48H","descriptor":{"symbol":"https://cdn.shopify.com/s/files/1/0739/2454/2758/products/Barkstix_Chicken_Hemp_Front.png?v=1680605739","images":["https://cdn.shopify.com/s/files/1/0739/2454/2758/products/Barkstix_Chicken_Hemp_Front.png?v=1680605739","https://cdn.shopify.com/s/files/1/0739/2454/2758/products/Barkstix_Chicken_Hemp_back.png?v=1680605739","https://cdn.shopify.com/s/files/1/0739/2454/2758/products/Barkstix_Chicken_Hemp_USPimage.png?v=1680605739"],"code":"Barkstix Dog Treats for Training Adult & Puppies, 100g (Chicken & Hemp)","name":"Barkstix Dog Treats for Training Adult & Puppies, 100g (Chicken & Hemp) - ( 100gm )","short_desc":"Barkstix Dog Treats for Training Adult & Puppies, 100g (Chicken & Hemp) - ( 100gm )","long_desc":"Barkstix Dog Treats for Training Adult & Puppies, 100g (Chicken & Hemp) - ( 100gm )"},"payment_ids":["./local_retail/ind/1@preprod-wiggles.humbhionline.in.payment"],"rateable":false,"location_id":"./local_retail/ind/80777412902@preprod-wiggles.humbhionline.in.provider_location","fulfillment_ids":["./local_retail/ind/2@preprod-wiggles.humbhionline.in.fulfillment"],"tags":[{"code":"origin","list":[{"code":"country","value":"IND"}]},{"code":"veg_nonveg","list":[{"code":"veg","value":"no"}]}],"fulfillment_id":"./local_retail/ind/2@preprod-wiggles.humbhionline.in.fulfillment","recommended":true,"@ondc/org/return_window":"PT0S","@ondc/org/available_on_cod":false,"category_id":"Pet Care","related":true,"price":{"listed_value":"229","offered_value":"229","currency":"INR","maximum_value":"229","value":"229"},"matched":true,"time":{"label":"enable","timestamp":"2023-11-05T18:30:00.000Z"},"id":"./local_retail/ind/44773287657766@preprod-wiggles.humbhionline.in.item"},{"@ondc/org/cancellable":true,"@ondc/org/returnable":false,"quantity":{"available":{"count":"50"},"maximum":{"count":"50"},"unitized":{"measure":{"unit":"unit","computed_value":"0","value":"1","estimated_value":"0"},"count":1}},"location_ids":["./local_retail/ind/80777412902@preprod-wiggles.humbhionline.in.provider_location"],"@ondc/org/statutory_reqs_packaged_commodities":{"common_or_generic_name_of_commodity":"Dogs and Cats","net_quantity_or_measure_of_commodity_in_pkg":"100 gms","imported_product_country_of_origin":"IND","manufacturer_or_packer_name":"Wiggles","manufacturer_or_packer_address":"Wiggles shopify store, , ,Pride Apartment 182 Bannerghatta Main Road Phase 4 Bilekahalli,A302, ,Bengaluru,Karnataka,IN,560076","month_year_of_manufacture_packing_import":"Please refer to the packaging of the product"},"@ondc/org/contact_details_consumer_care":"Wiggles shopify store,venkatramanm@gmail.com,1234567890","@ondc/org/seller_pickup_return":false,"@ondc/org/time_to_ship":"PT48H","descriptor":{"symbol":"https://cdn.shopify.com/s/files/1/0739/2454/2758/products/Artboard1_5d274230-45d1-48a8-831b-d805187a9eae.png?v=1680605768","images":["https://cdn.shopify.com/s/files/1/0739/2454/2758/products/Artboard1_5d274230-45d1-48a8-831b-d805187a9eae.png?v=1680605768","https://cdn.shopify.com/s/files/1/0739/2454/2758/products/Artboard1copy_d643cf77-48d2-4730-b1ea-6d44bc4489cf.png?v=1680605768","https://cdn.shopify.com/s/files/1/0739/2454/2758/products/Artboard1copy2_93e25a41-49f0-4b9f-a18c-09e59a640ed5.png?v=1680605768"],"code":"EPIBOON™ Antifungal Dusting Powder for Dogs & Cats - 100gm","name":"EPIBOON™ Antifungal Dusting Powder for Dogs & Cats - 100gm - ( 100 g )","short_desc":"EPIBOON™ Antifungal Dusting Powder for Dogs & Cats - 100gm - ( 100 g )","long_desc":"EPIBOON™ Antifungal Dusting Powder for Dogs & Cats - 100gm - ( 100 g )"},"payment_ids":["./local_retail/ind/1@preprod-wiggles.humbhionline.in.payment"],"rateable":false,"location_id":"./local_retail/ind/80777412902@preprod-wiggles.humbhionline.in.provider_location","fulfillment_ids":["./local_retail/ind/2@preprod-wiggles.humbhionline.in.fulfillment"],"tags":[{"code":"origin","list":[{"code":"country","value":"IND"}]},{"code":"veg_nonveg","list":[{"code":"veg","value":"no"}]}],"fulfillment_id":"./local_retail/ind/2@preprod-wiggles.humbhionline.in.fulfillment","recommended":true,"@ondc/org/return_window":"PT0S","@ondc/org/available_on_cod":false,"category_id":"Pet Care","related":true,"price":{"listed_value":"210","offered_value":"210","currency":"INR","maximum_value":"210","value":"210"},"matched":true,"time":{"label":"enable","timestamp":"2023-11-05T18:30:00.000Z"},"id":"./local_retail/ind/44773290770726@preprod-wiggles.humbhionline.in.item"}],"ttl":"PT2M","tags":[{"code":"serviceability","list":[{"code":"location","value":"./local_retail/ind/80777412902@preprod-wiggles.humbhionline.in.provider_location"},{"code":"category","value":"Pet Care"},{"code":"type","value":"10"},{"code":"val","value":"10000.0"},{"code":"unit","value":"km"}]}]}],"bpp/fulfillments":[{"id":"./local_retail/ind/2@preprod-wiggles.humbhionline.in.fulfillment","rateable":false,"type":"Delivery","tracking":false}],"bpp/descriptor":{"symbol":"https://cdn.shopify.com/s/files/1/0647/3662/4854/files/logo_2_1_fc405c5b-4db5-419a-8ec3-380144685e90.svg?v=1669615619","images":["https://cdn.shopify.com/s/files/1/0647/3662/4854/files/logo_2_1_fc405c5b-4db5-419a-8ec3-380144685e90.svg?v=1669615619"],"code":"preprod-wiggles.humbhionline.in","name":"Wiggles shopify store","short_desc":"Wiggles shopify store","long_desc":"Wiggles shopify store"}}}}
                ]
            },
            "assertion": {
                "and": [
                    {
                        "script": {
                            "eval": "search.response.data[0].message.catalog['bpp/providers'].length > 0 && search.response.data[0].message.catalog['bpp/providers'].filter(function(p){ return p.time.label === 'enable'})[0].items.length > 5",
                            "message": "Atleast 5 Items in Catalog"
                        }
                    }
                ]
            },
            "logs": [
                {
                    "name": "search_full_catalog_refresh.log",
                    "value": "${JSON.stringify(search.request.body)}"
                },
                {
                    "name": "on_search_full_catalog_refresh.log",
                    "value": "${JSON.stringify(search.response.data[0])}"
                }
            ]
        },
        {
            "name": "select",
            "request_finalizer": [  "var UUID = Java.type('java.util.UUID') ;",
                                    "var message_id = UUID.randomUUID().toString();",
                                    "var transaction_id = UUID.randomUUID().toString() ;",
                                    "request.body.context.message_id = message_id ;",
                                    "request.body.context.transaction_id = transaction_id; ",
                                    "items = JSON.parse(JSON.stringify(search.response.data[0].message.catalog['bpp/providers'].filter(function(p){ return p.time.label === 'enable'})[0].items)); ",
                                    "items.forEach(function(i){ newi = {} ; newi.id = i.id , newi.location_id = i.location_id ; newi.quantity = {}; newi.quantity.count = 1  ;request.body.message.order.items.push(newi)})",
                                    "request.body.message.order.items = request.body.message.order.items.slice(0,2) ;",
                                    "request.body.message.order.provider = bpp.provider;"
                                    ],
            "request": {
                "body": {
                    "context": {
                        "bpp_id": "${context.bpp_id}",
                        "city": "${context.city}",
                        "core_version": "${context.core_version}",
                        "country": "${context.country}",
                        "domain": "${context.domain}",
                        "action": "select",
                        "bap_id": "${context.bap_id}",
                        "bap_uri": "${context.bap_uri}",
                        "ttl": "${context.ttl}",
                        "timestamp": "${env.now}"
                    },
                    "message": {
                        "order" : {
                            "fulfillments" : [{
                                "end" :{
                                    "location" : {
                                        "address" : { 
                                            "area_code" : "${bpp.fulfillment.end.location.address.area_code}" 
                                        },
                                        "gps" : "${bpp.fulfillment.end.location.gps}"
                                    }
                                }
                            }],
                            "items" : []
                        }
                    }
                },
                "headers": {
                    "Authorization": "${authorization.basic}",
                    "Content-Type": "application/json",
                    "X-CallBackToBeSynchronized": "Y"
                },
                "method": "post",
                "timeout": 60,
                "url": "${sync_bap_url}/select"
            },
            "assertion" : {
                "script" : {"eval" :"select.response.status == 200" }
            },
            "logs": [
                {
                    "name": "select.log",
                    "value": "${JSON.stringify(select.request.body)}"
                },
                {
                    "name": "on_select.log",
                    "value": "${JSON.stringify(select.response.data)}"
                }
            ]
        },
        {
            "name": "init",
            "request_finalizer": [  "var UUID = Java.type('java.util.UUID') ;",
                                    "var message_id = UUID.randomUUID().toString();",
                                    "request.body.context.message_id = message_id ;",
                                    "request.body.context.transaction_id = select.request.body.context.transaction_id; ",
                                    "request.body.message.order.billing.address = bpp.fulfillment.end.location.address;",
                                    "request.body.message.order.billing.created_at = env.now;",
                                    "request.body.message.order.billing.updated_at = env.now;",
                                    "request.body.message.order.fulfillments = [];",
                                    "request.body.message.order.fulfillments.push(JSON.parse(JSON.stringify(bpp.fulfillment)));",
                                    "delete request.body.message.order.fulfillments[0].end.person",
                                    "request.body.message.order.fulfillments[0].id = select.response.data.message.order.fulfillments[0].id;",

                                    "items = JSON.parse(JSON.stringify(select.response.data.message.order.items)); ",
                                    "items.forEach(function(i){ newi = {} ; newi.id = i.id , newi.location_id = i.location_id ; newi.quantity = {}; newi.quantity.count = 1  ;request.body.message.order.items.push(newi)});",
                                    "request.body.message.order.provider = bpp.provider;"
                                    ],
            "request": {
                "body": {
                    "context": {
                        "bpp_id": "${context.bpp_id}",
                        "city": "${context.city}",
                        "core_version": "${context.core_version}",
                        "country": "${context.country}",
                        "domain": "${context.domain}",
                        "action": "init",
                        "bap_id": "${context.bap_id}",
                        "bap_uri": "${context.bap_uri}",
                        "ttl": "${context.ttl}",
                        "timestamp": "${env.now}"
                    },
                    "message": {
                        "order" : {
                            "billing": {
                                "email" : "${bpp.fulfillment.end.contact.email}",
                                "phone" : "${bpp.fulfillment.end.contact.phone}",
                                "name" : "${bpp.fulfillment.end.location.address.name}"
                            },
                            "items" : []
                        }
                    }
                },
                "headers": {
                    "Authorization": "${authorization.basic}",
                    "Content-Type": "application/json",
                    "X-CallBackToBeSynchronized": "Y"
                },
                "method": "post",
                "timeout": 60,
                "url": "${sync_bap_url}/init"
            },
            "assertion" : {
                "script" : {"eval" :"init.response.status == 200" }
            },
            "logs": [
                {
                    "name": "init.log",
                    "value": "${JSON.stringify(init.request.body)}"
                },
                {
                    "name": "on_init.log",
                    "value": "${JSON.stringify(init.response.data)}"
                }
            ]
        },
        {
            "name": "confirm",
            "request_finalizer": [  "var UUID = Java.type('java.util.UUID') ;",
                                    "var message_id = UUID.randomUUID().toString();",
                                    "var payment_transaction_id = UUID.randomUUID().toString();",
                                    "request.body.context.message_id = message_id ;",
                                    "request.body.context.transaction_id = select.request.body.context.transaction_id; ",
                                    "request.body.message.order.created_at = env.now",
                                    "request.body.message.order.id = init.request.body.context.transaction_id",
                                    "request.body.message.order.fulfillments = init.request.body.message.order.fulfillments;",
                                    "request.body.message.order.fulfillments[0].end.person = bpp.fulfillment.end.person",

                                    "request.body.message.order.updated_at = env.now",
                                    "request.body.message.order.billing= init.request.body.message.order.billing;",

                                    "items = JSON.parse(JSON.stringify(init.response.data.message.order.items)); ",
                                    "items.forEach(function(i){ newi = {} ; newi.id = i.id , newi.fulfillment_id = i.fulfillment_id ; newi.quantity = {}; newi.quantity.count = i.quantity.count  ;request.body.message.order.items.push(newi)});",

                                    "request.body.message.order.payment = JSON.parse(JSON.stringify(init.response.data.message.order.payment));",
                                    "request.body.message.order.payment.status = \"PAID\" ; request.body.message.order.payment.tl_method = \"http/get\" ;   request.body.message.order.payment.uri = \"https://juspay.in\";",
                                    "request.body.message.order.payment.params.transaction_id = payment_transaction_id;",

                                    "request.body.message.order.provider = init.response.data.message.order.provider;",

                                    "request.body.message.order.quote = init.response.data.message.order.quote;",
                                    "request.body.message.order.state = \"Created\";",
                                    "request.body.message.order.tags = JSON.parse(JSON.stringify(init.response.data.message.order.tags));",
                                    "bap_terms = {} ; bap_terms.code = \"bap_terms\"; bap_terms.list = []; ",
                                    "bap_terms.list.push({\"code\":\"tax_number\", \"value\" : \"29AAWPM7654G1ZV\"}); ",
                                    "request.body.message.order.tags.push(bap_terms);"
                                    ],
            "request": {
                "body": {
                    "context": {
                        "bpp_id": "${context.bpp_id}",
                        "city": "${context.city}",
                        "core_version": "${context.core_version}",
                        "country": "${context.country}",
                        "domain": "${context.domain}",
                        "action": "confirm",
                        "bap_id": "${context.bap_id}",
                        "bap_uri": "${context.bap_uri}",
                        "ttl": "${context.ttl}",
                        "timestamp": "${env.now}"
                    },
                    "message": {
                        "order" : {
                            "items" : []
                        }
                    }
                },
                "headers": {
                    "Authorization": "${authorization.basic}",
                    "Content-Type": "application/json",
                    "X-CallBackToBeSynchronized": "Y"
                },
                "method": "post",
                "timeout": 60,
                "url": "${sync_bap_url}/confirm"
            },
            "assertion" : {
                "script" : {"eval" :"confirm.response.status == 200" }
            },
            "logs": [
                {
                    "name": "confirm.log",
                    "value": "${JSON.stringify(confirm.request.body)}"
                },
                {
                    "name": "on_confirm.log",
                    "value": "${JSON.stringify(confirm.response.data)}"
                }
            ]
        },
        {
            "name" : "status_updates",
            "flow" : "${bpp.flow.status_updates}"
        }

    ]
}
